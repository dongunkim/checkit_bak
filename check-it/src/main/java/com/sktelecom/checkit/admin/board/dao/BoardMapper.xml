<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin.board.dao">
	
	<select id="boardList" parameterType="paramMap" resultType="commMap">
		/* admin.board.dao.BoardMapper.xml boardList */
		SELECT 
			COUNT(*) OVER () AS RNUM_CNT
			,BOARD_ID
			,BOARD_TITLE
			,BOARD_DESC
			,VIEW_COUNT
			,BP_DISP_YN
			,USE_YN                             
			,REG_ID
			,REG_DT
			,UPD_ID
			,UPD_DT
		FROM T_BOARD                                                                
		WHERE BOARD_TYPE = #{boardType}
		<if test="searchGbn != null and searchGbn != '' and searchGbn.equals('bbs_title') ">		
		AND UPPER(TRIM(BOARD_TITLE)) LIKE CONCAT('%',UPPER(TRIM(#{searchText})),'%')
		</if>	
		<if test="searchGbn != null and searchGbn != '' and searchGbn.equals('reg_id') ">				
		AND REG_ID IN(SELECT USER_ID FROM USER_INFO WHERE UPPER(REPLACE(USER_NM, ' ','')) LIKE CONCAT('%',#{searchText},'%'))
		</if>
		<if test="calFrom != null and calFrom != ''">
		AND (REG_DT BETWEEN CONCAT(REPLACE(#{calFrom},'-',''), '000000') AND CONCAT(REPLACE(#{calTo},'-',''), '235959') 	)
		</if>
		ORDER BY BOARD_ID DESC
		LIMIT #{startPageNo},#{pageSize}
	</select>	
	
	<select id="boardDetail" parameterType="paramMap" resultType="commMap">
		/* admin.board.dao.BoardMapper.xml boardDetail */
		SELECT 
			 BOARD_ID
			,BOARD_TITLE
			,BOARD_DESC
			,VIEW_COUNT
			,BP_DISP_YN
			,USE_YN                             
			,REG_ID
			,REG_DT
			,UPD_ID
			,UPD_DT
		FROM T_BOARD                                                                
		WHERE BOARD_TYPE = #{boardType}
		AND BOARD_ID = #{boardId}		
	</select>
	
	<!-- 조회수 증가 -->
	<update id="updateViewCntBoard" parameterType="paramMap">
		/* admin.board.dao.BoardMapper.xml updateViewCntBoard */
		UPDATE 	T_BOARD
		SET 	VIEW_COUNT = VIEW_COUNT + 1
		WHERE 	BOARD_TYPE = #{boardType}
		AND BOARD_ID = #{boardId}
	</update>
	
	<insert id="insertBoard" parameterType="paramMap">
		/* admin.board.dao.BoardMapper.xml insertBoard */
		INSERT INTO T_BOARD 
		(
			 BOARD_TYPE
			,BOARD_ID
			,BOARD_TITLE
			,BOARD_DESC
			,VIEW_COUNT
			,BP_DISP_YN
			,USE_YN			
			,REG_ID
			,REG_DT
			,UPD_ID			
			,UPD_DT			
		)
		SELECT
			#{boardType}
			,IFNULL(MAX(BOARD_ID),0)+1
			,#{boardTitle}
			,#{boardDesc}
			,0
			,#{bpDisplayYn}
			,'N'
			,#{regId}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,#{regId}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
		FROM T_BOARD
		WHERE BOARD_TYPE = #{boardType}
	</insert>
	
	<!-- 게시판 수정 -->
	<update id="updateBoard" parameterType="paramMap">
		/* admin.board.dao.BoardMapper.xml updateBoard */		
		UPDATE T_BOARD  
		SET 				
			UPD_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			, UPD_ID = #{updId}
			<if test="boardTitle != null and boardTitle != ''">
			, BOARD_TITLE = #{boardTitle}
			</if>
			<if test="boardDesc != null and boardDesc != ''">
			, BOARD_DESC = #{boardDesc}
			</if>
			<if test="viewCount != null and viewCount != ''">
			, VIEW_COUNT = #{viewCount}
			</if>
			<if test="viewCnt != null and viewCnt != ''">
			, USE_YN = #{useYn}
			</if>
		WHERE BOARD_TYPE = #{boardType}
		AND BOARD_ID = #{boardId}		
	</update>
	
	<!-- 게시판 삭제 -->
	<update id="deleteBoard" parameterType="paramMap">
		/* admin.board.dao.BoardMapper.xml deleteBoard */		
		DELETE FROM T_BOARD  
		WHERE BOARD_TYPE = #{boardType}
		  AND BOARD_ID = #{boardId}		
	</update>
</mapper>