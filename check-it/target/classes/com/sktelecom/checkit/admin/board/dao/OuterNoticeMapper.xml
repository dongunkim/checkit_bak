<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin.board.dao">
	
	<!-- 고객 공지 현황 목록 화면 -->
	<select id="bord0301List" parameterType="paramMap" resultType="commMap">
		/* admin.board.dao.Bord03Mapper.xml bord0301List */
		SELECT 
			 COUNT(*) OVER() RNUM_CNT                          
			,BBS_NO
			,BBS_SUB_NO
			,BBS_GB
			,BBS_TITLE                             
			,BBS_DESC
			,ATTACH_ID
			,GONGJI_DD
			,CS_GONGJI_YN
			,REPL_CNT                                    
			,REG_DT
			,REG_ID
			,FN_GET_USERNM(OUTER_GONGJI.REG_ID) REG_NM
			,UPD_DT
			,UPD_ID
			,VIEW_CNT                                   
			,(SELECT CODE_NAME FROM T_CODE C WHERE C.CODE_ID = OUTER_GONGJI.BBS_GB) AS BBS_GB_NM 
		FROM OUTER_GONGJI                                                                
		WHERE OUTER_GONGJI.DEL_YN = 'N'
		<!-- 상단 검색창에서 입력받은 것을 처리 -->
		<if test="searchGbn != null and searchGbn != '' and searchGbn.equals('bbs_title') ">		
		  AND UPPER(TRIM(OUTER_GONGJI.BBS_TITLE)) LIKE CONCAT('%',UPPER(TRIM(#{searchText})),'%')
		<!-- AND     REPLACE(UPPER(OUTER_GONGJI.BBS_TITLE),' ','') LIKE REPLACE(UPPER(CONCAT('%',#{searchText},'%')),' ','') -->
		</if>	
		<if test="searchGbn != null and searchGbn != '' and searchGbn.equals('reg_id') ">				
		  AND OUTER_GONGJI.REG_ID IN(SELECT USER_ID FROM USER_INFO WHERE UPPER(REPLACE(USER_NM, ' ','')) LIKE CONCAT('%',#{searchText},'%'))
		</if>
		<if test="searchBbsGb != null and searchBbsGb != ''"	>		
		  AND OUTER_GONGJI.BBS_GB = #{searchBbsGb}
		</if>
		<if test="calFrom != null and calFrom != ''">
		  AND (OUTER_GONGJI.REG_DT BETWEEN CONCAT(REPLACE(#{calFrom},'-',''), '000000') AND CONCAT(REPLACE(#{calTo},'-',''), '235959') 	)
		</if>
		<!-- 상단 검색창에서 입력받은 것을 처리 -->
		ORDER BY OUTER_GONGJI.REG_DT DESC, OUTER_GONGJI.BBS_NO DESC
		<if test="isPaging == true">
		LIMIT #{startPageNo},#{pageSize}
		</if>
	</select>	
	
	<!-- 고객 공지 현황 상세 화면 -->
	<select id="bord0302Detail" parameterType="paramMap" resultType="commMap">
		<![CDATA[
		/* admin.board.dao.Bord03Mapper.xml bord0302Detail */
		SELECT 
			BBS_NO
			,BBS_SUB_NO
			,BBS_GB
			,BBS_TITLE                             
			,BBS_DESC
			,ATTACH_ID
			,GONGJI_DD
			,CS_GONGJI_YN
			,REPL_CNT                                    
			,REG_DT
			,REG_ID
			,FN_GET_USERNM(OUTER_GONGJI.REG_ID) REG_NM
			,UPD_DT
			,UPD_ID
			,VIEW_CNT                                   
			,(SELECT CODE_NAME FROM T_CODE C WHERE C.CODE_ID = OUTER_GONGJI.BBS_GB) AS BBS_GB_NM 
		FROM OUTER_GONGJI                                                                
		WHERE BBS_NO = #{bbsNo}		
		]]>
	</select>
	
	<!-- 고객 공지 현황 수정 화면 -->
	<select id="bord0304Edit" parameterType="paramMap" resultType="commMap">
		/* admin.board.dao.Bord03Mapper.xml bord0304Edit */
		SELECT
			BBS_NO,
			,BBS_SUB_NO 
			,BBS_GB 
			,BBS_TITLE 
			,BBS_DESC 
			,ATTACH_ID 
			,GONGJI_DD 
			CS_GONGJI_YN 
		FROM OUTER_GONGJI 
		WHERE  BBS_NO = #{bbsNo}		                                        
	</select>
	
	<!-- 고객 공지 현황 수정 화면 -->
	<select id="bord0304EditGonjlUser" parameterType="paramMap" resultType="commMap">
		/* admin.board.dao.Bord03Mapper.xml bord0304EditGonjlUser */
		SELECT 
		    OG.BBS_NO
		    ,OG.CS_NO
		    ,CI.CS_NAME
		FROM OUTER_GONGJI_CS OG 
			LEFT JOIN CUST_INFO CI ON CI.CS_NO = OG.CS_NO 
		WHERE OG.BBS_NO = #{bbsNo}
	</select>
	
	<!-- 조회수 증가 -->
	<update id="updateViewCntBord03" parameterType="paramMap">
		/* admin.board.dao.Bord01Mapper.xml updateViewCntBord03 */
		UPDATE OUTER_GONGJI
		SET
			VIEW_CNT = VIEW_CNT + 1
		WHERE BBS_NO = #{bbsNo}
	</update>
	
	<!-- 고객 공지 현황 등록 화면 -->
	<insert id="insertBord0303" parameterType="paramMap">
		<![CDATA[
		/* admin.board.dao.Bord03Mapper.xml insertBord0303 */		
		INSERT INTO OUTER_GONGJI 
		(
			BBS_NO
			,BBS_SUB_NO
			,BBS_GB
			,BBS_TITLE
			,BBS_DESC
			,ATTACH_ID
			,GONGJI_DD
			,CS_GONGJI_YN
			,REPL_CNT
			,REG_DT
			,REG_ID
			,UPD_DT			
			,VIEW_CNT
			,DEL_YN			
		)
		VALUES
		(
			 #{bbsNo}
			,#{bbsSubNo}
			,#{bbsGb}
			,#{bbsTitle}
			,#{bbsDesc}
			,#{attachId}
			,REPLACE(#{gongjiDd}, '-','')
			,#{csGongjiYn}
			,#{replCnt}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,#{regId}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,#{viewCnt}
			,#{delYn}
		)
		]]>
	</insert>
	
	<!-- 고객 공지 현황 등록 화면 -->
	<insert id="deleteBordCsNo" parameterType="paramMap">
		/* admin.board.dao.Bord03Mapper.xml deleteBordCsNo */		
		DELETE FROM OUTER_GONGJI_CS
		WHERE BBS_NO = #{bbsNo};
	</insert>
	
	<!-- 고객 공지 현황 등록 화면 -->
	<insert id="insertBordCsNo" parameterType="paramMap">
		/* admin.board.dao.Bord03Mapper.xml insertBordCsNo */		
		INSERT INTO OUTER_GONGJI_CS
		(
			 BBS_NO
			,CS_NO
			,REG_DT
			,REG_ID
		)
		VALUES
		(
			 #{bbsNo}
			,#{csNo}
			,DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,#{regId}
		)
	</insert>
	
	<!-- 고객 공지 현황 수정 화면 -->
	<update id="updateBord0304" parameterType="paramMap">
		/* admin.board.dao.Bord03Mapper.xml updateBord0304 */
		UPDATE OUTER_GONGJI  
		SET 				
			UPD_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,UPD_ID = #{updId}
			<if test="bbsSubNo != null and bbsSubNo != ''">
			,BBS_SUB_NO = #{bbsSubNo}
			</if>
			<if test="bbsGb != null and bbsGb != ''">
			,BBS_GB = #{bbsGb}
			</if>				
			<if test="bbsTitle != null and bbsTitle != ''">
			,BBS_TITLE = #{bbsTitle}
			</if>
			<if test="bbsDesc != null and bbsDesc != ''">
			,BBS_DESC = #{bbsDesc}
			</if>
			<if test="attachId != null and attachId != ''">
			,ATTACH_ID = #{attachId}
			</if>
			<if test="replCnt != null and replCnt != ''">
			,REPL_CNT = #{replCnt}
			</if>
			<if test="viewCnt != null and viewCnt != ''">
			,VIEW_CNT = #{viewCnt}
			</if>
			<if test="viewCnt != null and viewCnt != ''">
			,DEL_YN = #{delYn}
			</if>
		WHERE BBS_NO = #{bbsNo}		
	</update>
	
	<!-- 고객 공지 삭제 -->
	<update id="deleteBord0305" parameterType="paramMap">
		/* admin.board.dao.Bord03Mapper.xml deleteBord0305 */                         		                                                        
		UPDATE OUTER_GONGJI  
		SET   	
			UPD_DT = DATE_FORMAT(NOW(), '%Y%m%d%H%i%s')
			,UPD_ID = #{updId}
			,DEL_YN = #{delYn}
		WHERE   OUTER_GONGJI.BBS_NO = #{bbsNo}		
	</update>
</mapper>